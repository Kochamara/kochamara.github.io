<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" href="/assets/favicon.png" type="image/png">
  <link href="/src/output.css" rel="stylesheet">
  <title>spencer guy</title>
</head>
<body class="relative min-h-screen overflow-x-hidden text-gray-900 bg-white">

  <video id="bgVideo" autoplay muted loop playsinline
    class="absolute top-0 left-0 w-full h-full object-cover blur-md z-[-2]">
    <source src="assets/background.mp4" type="video/mp4">
    <source src="assets/background.webm" type="video/webm">
  </video>

  <div class="absolute inset-0 bg-white/50 backdrop-blur z-[-1]"></div>

  <div class="relative z-10 flex justify-center items-center min-h-[60vh] px-4">
    <img src="assets/header.gif" alt="Header animation" class="w-[480px] h-[270px] object-contain">
  </div>
  

  <div id="project-list" class="relative z-10 px-6 pb-16 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8"></div>

  <footer class="py-10 text-center text-sm text-gray-400">footer</footer>

  <div id="project-modal" class="fixed inset-0 z-50 bg-white/90 backdrop-blur-lg overflow-y-auto p-6 hidden">
    <button id="modal-close" class="absolute top-4 right-6 text-gray-600 text-2xl">&times;</button>
    <div id="modal-content" class="max-w-full sm:max-w-3xl mx-auto space-y-6 p-4"></div>
  </div>

  <script type="module">
    const container = document.getElementById("project-list");
    const modal = document.getElementById("project-modal");
    const modalContent = document.getElementById("modal-content");
    const closeBtn = document.getElementById("modal-close");

    const projects = await fetch("projects.json").then(res => res.json());

    for (const project of projects) {
      const el = document.createElement("a");
      el.href = `#${project.slug}`;
      el.className = "block rounded-2xl overflow-hidden bg-white/80 backdrop-blur-lg hover:shadow-xl transition-shadow shadow-md";
      el.innerHTML = `
        <img src="${project.thumbnail}" alt="${project.title}" class="w-full h-48 object-cover">
        <div class="p-5">
          <h2 class="text-xl font-semibold text-gray-900 mb-2">${project.title}</h2>
          <p class="text-sm text-gray-700">${project.description}</p>
        </div>
      `;
      el.addEventListener("click", e => {
        e.preventDefault();
        openProjectModal(project.slug);
      });
      container.appendChild(el);
    }

    function openProjectModal(slug) {
      const project = projects.find(p => p.slug === slug);
      if (!project) return;

      history.pushState({ slug }, "", `#${slug}`);
      renderModal(project);
      modal.classList.remove("hidden");
      document.body.style.overflow = 'hidden';
    }

    function closeModal() {
      modal.classList.add("hidden");
      document.body.style.overflow = '';
      history.pushState({}, "", "index.html");
    }

    function renderModal(project) {
      document.title = project.title;
      modalContent.innerHTML = `
        <h2 class="text-3xl font-bold">${project.title}</h2>
        <p class="text-gray-600">${project.description}</p>
      `;

      const hasYouTube = project.assets.some(a => a.type === "youtube");

      for (const asset of project.assets || []) {
        let el;
        if (asset.type === "youtube") {
          const id = new URL(asset.url).searchParams.get("v");
          el = document.createElement("iframe");
          el.src = `https://www.youtube.com/embed/${id}`;
          el.className = "w-full aspect-video rounded-xl shadow-lg";
          el.allowFullscreen = true;
          el.frameBorder = "0";
        } else if (asset.type === "image") {
          el = document.createElement("img");
          el.src = asset.url;
          el.alt = asset.label || "";
          el.className = "w-full rounded-xl shadow-md";
        }
        if (el) modalContent.appendChild(el);
      }

      const lfsVideos = project.assets.filter(a => a.type === "video");
      if (lfsVideos.length > 0) {
        const list = document.createElement("ul");
        list.className = "mt-6 space-y-2 text-blue-600 underline text-sm";

        for (const asset of lfsVideos) {
          const extension = asset.url.split('.').pop();
          const link = document.createElement("a");
          link.href = asset.url;
          link.textContent = `â¬‡ download .${extension}`;
          link.className = "hover:text-blue-800";
          link.target = "_blank";
          const item = document.createElement("li");
          item.appendChild(link);
          list.appendChild(item);
        }

        const section = document.createElement("div");
        section.className = "pt-4 border-t border-gray-200";
        section.appendChild(list);
        modalContent.appendChild(section);
      }
    }

    closeBtn.addEventListener("click", closeModal);
    window.addEventListener("popstate", () => {
      if (!location.hash) closeModal();
    });

    window.addEventListener("keydown", (e) => {
      if (e.key === "Escape") closeModal();
    });

    if (location.hash) {
      const slug = location.hash.substring(1);
      openProjectModal(slug);
    }
  </script>

  <script>
    const video = document.getElementById("bgVideo");
    video.playbackRate = 0.05;
  </script>

</body>
</html>